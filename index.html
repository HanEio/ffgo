<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9X6RW35EHV"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-9X6RW35EHV');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>查分前必看！在这里查加100分，最后转发加100分！</title>
    <!-- 引入 Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Google Fonts for elegant typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .lantern {
            position: absolute;
            width: 80px;
            height: 100px;
            background: radial-gradient(circle at 50% 40%, rgba(255,240,180,0.9), rgba(255,165,0,0.8));
            border-radius: 45% 45% 30% 30%;
            box-shadow: 0 0 20px rgba(255,190,0,0.7);
            transition: all 1s ease-in-out;
        }
        .lantern::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 90px;
            height: 15px;
            background: #a855f7; /* purple-600 */
            border-radius: 5px;
            border-bottom: 2px solid #9333ea; /* purple-700 */
        }
         .lantern::after {
            content: '';
            position: absolute;
            bottom: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 10px;
            background: red;
            border-radius: 2px;
            box-shadow: 0 0 10px red;
        }
        .lantern-light-off {
             background: radial-gradient(circle at 50% 40%, #a1a1aa, #71717a); /* zinc-400, zinc-500 */
             box-shadow: none;
        }
        .lantern-container {
            transition: transform 15s linear, opacity 15s linear;
        }
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 2s infinite ease-in-out;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        @keyframes gentle-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-bob {
            animation: gentle-bob 4s ease-in-out infinite;
        }
        .fade-in {
            animation: fadeInAnimation 1s ease-in-out forwards;
        }
        .fade-out {
            animation: fadeOutAnimation 1s ease-in-out forwards;
        }
        @keyframes fadeInAnimation {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOutAnimation {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); display: none; }
        }
        @keyframes pulse-light {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 235, 150, 0.2); }
            50% { box-shadow: 0 0 15px rgba(255, 235, 150, 0.6); }
        }
        .lantern-pulsing {
            animation: pulse-light 2s infinite ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-x-hidden">

    <!-- Background Stars -->
    <div id="star-container" class="fixed top-0 left-0 w-full h-full -z-10"></div>
    
    <!-- Friend Referral Banner -->
    <div id="referral-banner" class="hidden fixed top-0 left-0 w-full bg-purple-600 text-center py-2 text-sm z-50 fade-in">
        <p>您正在为好友助力，也为自己许个愿吧！</p>
    </div>

    <!-- Main Container -->
    <div id="main-container" class="relative min-h-screen flex flex-col items-center justify-center p-4 transition-opacity duration-1000">

        <!-- Landing Page -->
        <section id="landing-page" class="text-center fade-in">
            <h1 class="text-4xl md:text-6xl font-bold text-yellow-300 tracking-wider" style="text-shadow: 0 0 10px #facc15;">金榜题名时</h1>
            <p class="mt-4 text-lg md:text-xl text-gray-300">为十年寒窗，许一个灿烂前程。</p>
            
            <div class="my-8">
                <p class="text-gray-400">距离吉时开启还有</p>
                <div id="countdown" class="text-3xl md:text-5xl font-bold text-yellow-400 mt-2 tracking-widest">
                    <span>00</span>:<span>00</span>:<span>00</span>:<span>00</span>
                </div>
            </div>

            <button id="start-wishing-btn" class="mt-8 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-full shadow-lg shadow-purple-500/50 transform hover:scale-105 transition-all duration-300">
                开启祈福之旅
            </button>
            <p class="mt-4 text-sm text-gray-500">已有 <span id="visitor-count" class="font-bold text-yellow-400">88888</span> 位追梦人在此祈福</p>
        </section>

        <!-- Wishing Ritual Modal -->
        <div id="wishing-modal" class="hidden fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm z-40 flex items-center justify-center">
            <div id="ritual-content" class="bg-gray-800/80 p-8 rounded-2xl shadow-2xl shadow-purple-900/50 border border-purple-700/50 w-11/12 max-w-md text-center flex flex-col items-center">
                <h2 class="text-2xl font-bold text-yellow-300 mb-2">寄托心愿</h2>
                <p class="text-gray-400 mb-4">写下期盼，然后点击按钮点亮孔明灯。</p>
                
                <div class="relative w-full h-32 flex items-center justify-center animate-bob my-4">
                     <div id="lantern-container" class="relative">
                         <div id="interactive-lantern" class="lantern lantern-light-off"></div>
                     </div>
                </div>

                <textarea id="wish-input" class="w-full h-24 bg-gray-900/70 border border-purple-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300" placeholder="在此写下你的心愿..."></textarea>
                
                <button id="light-up-btn" class="mt-6 w-full bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-2 px-4 rounded-full transition-all duration-300 disabled:bg-yellow-800 disabled:cursor-not-allowed">
                    点亮
                </button>
                <p id="error-message" class="mt-2 text-sm text-red-400 h-5"></p>
            </div>
        </div>

        <!-- Sharable Poster Modal with Score Query -->
        <div id="poster-modal" class="hidden fixed inset-0 bg-black bg-opacity-80 backdrop-blur-md z-50 flex items-center justify-center p-4">
             <div id="poster-content" class="bg-cover bg-center bg-no-repeat p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center border-2 border-yellow-400/80" style="background-image: url('');">
                 <div class="relative">
                     <h2 class="text-4xl font-bold text-yellow-300" style="text-shadow: 1px 1px 10px #ca8a04;">金榜题名</h2>
                     <p class="mt-4 text-lg text-white">未来可期</p>
                     
                     <div class="my-6 p-4 border-y-2 border-dashed border-yellow-400/50">
                         <p class="text-white">心愿已寄托于星海</p>
                         <p class="text-yellow-400 text-lg font-bold mt-2">“<span id="poster-wish"></span>”</p>
                     </div>

                     <p class="text-white">您是第 <span id="poster-visitor-count" class="font-bold text-2xl text-yellow-300">88888</span> 位</p>
                     <p class="text-white mb-4">点亮祈福灯的追梦人</p>
                     
                     <!-- ** NEW: Score Query Section ** -->
                     <div id="score-query-section" class="mt-6 w-full text-left">
                         <p class="text-white mb-3 text-center font-bold">成绩查询专区</p>
                         <input type="text" id="mmkNo-input" placeholder="请输入报考号" class="w-full bg-gray-900/70 border border-purple-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300 mb-2">
                         <input type="password" id="mmkPwd-input" placeholder="请输入密码" class="w-full bg-gray-900/70 border border-purple-600 rounded-lg p-3 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all duration-300">
                         <button id="query-score-btn" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full shadow-lg shadow-green-500/50 transform hover:scale-105 transition-all duration-300">
                             立即查分
                         </button>
                         <div id="score-result" class="mt-3 text-center text-yellow-300 h-10"></div>
                     </div>

                     <!-- ** Fission and Share Button ** -->
                     <button id="copy-link-btn" class="mt-4 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-full transition-all duration-300">
                         复制祝福链接，为心愿蓄力
                     </button>
                 </div>
             </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Elements ---
            const countdownElement = document.getElementById('countdown');
            const visitorCountElement = document.getElementById('visitor-count');
            const startWishingBtn = document.getElementById('start-wishing-btn');
            const wishingModal = document.getElementById('wishing-modal');
            
            const wishInput = document.getElementById('wish-input');
            const lanternContainer = document.getElementById('lantern-container');
            const interactiveLantern = document.getElementById('interactive-lantern');
            const lightUpBtn = document.getElementById('light-up-btn');
            const errorMessage = document.getElementById('error-message');

            const posterModal = document.getElementById('poster-modal');
            const posterWish = document.getElementById('poster-wish');
            const posterVisitorCount = document.getElementById('poster-visitor-count');
            const copyLinkBtn = document.getElementById('copy-link-btn');
            const referralBanner = document.getElementById('referral-banner');
            const mainContainer = document.getElementById('main-container');

            // --- NEW: Score Query Elements ---
            const queryScoreBtn = document.getElementById('query-score-btn');
            const mmkNoInput = document.getElementById('mmkNo-input');
            const mmkPwdInput = document.getElementById('mmkPwd-input');
            const scoreResultDiv = document.getElementById('score-result');

            let visitorCount = 88888 + Math.floor(Math.random() * 1000);
            let userWishId = '';
            visitorCountElement.textContent = visitorCount;
            const targetDate = new Date(new Date().getFullYear(), 5, 25, 10, 0, 0).getTime();

            function createStars() {
                const container = document.getElementById('star-container');
                const starCount = 100;
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    const size = Math.random() * 2 + 1;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.top = `${Math.random() * 100}%`;
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.animationDelay = `${Math.random() * 2}s`;
                    star.style.animationDuration = `${Math.random() * 2 + 1}s`;
                    container.appendChild(star);
                }
            }

            function updateCountdown() {
                const now = new Date().getTime();
                const distance = targetDate - now;

                if (distance < 0) {
                    countdownElement.innerHTML = "祝您金榜题名！";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                countdownElement.innerHTML = `<span>${String(days).padStart(2, '0')}</span>:<span>${String(hours).padStart(2, '0')}</span>:<span>${String(minutes).padStart(2, '0')}</span>:<span>${String(seconds).padStart(2, '0')}</span>`;
            }

            function copyToClipboard(text) {
                const textArea = document.createElement("textarea");
                textArea.value = text;
                textArea.style.position = "fixed"; 
                textArea.style.top = "-9999px";
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    copyLinkBtn.textContent = '已复制！快去分享吧！';
                } catch (err) {
                    console.error('无法复制链接: ', err);
                    copyLinkBtn.textContent = '复制失败，请手动复制';
                }
                document.body.removeChild(textArea);
            }
            
            startWishingBtn.addEventListener('click', () => {
                wishingModal.classList.remove('hidden');
                wishingModal.classList.add('fade-in');
            });
            
            wishInput.addEventListener('input', () => {
                if (wishInput.value.trim().length > 0) {
                    interactiveLantern.classList.add('lantern-pulsing');
                    errorMessage.textContent = ""; 
                } else {
                    interactiveLantern.classList.remove('lantern-pulsing');
                }
            });

            lightUpBtn.addEventListener('click', () => {
                if (wishInput.value.trim() === "") {
                    errorMessage.textContent = "请先写下您的心愿";
                    wishInput.focus();
                    wishInput.classList.add('border-red-500');
                    setTimeout(() => {
                        wishInput.classList.remove('border-red-500');
                    }, 2000);
                    return;
                }

                lightUpBtn.disabled = true;
                wishInput.disabled = true;
                interactiveLantern.classList.remove('lantern-light-off', 'lantern-pulsing');
                
                wishInput.style.transition = 'opacity 0.5s';
                wishInput.style.opacity = '0';
                lightUpBtn.style.transition = 'opacity 0.5s';
                lightUpBtn.style.opacity = '0';

                setTimeout(launchLantern, 1000);
            });

            function launchLantern() {
                visitorCount++;
                userWishId = Math.random().toString(36).substring(2, 8); 
                visitorCountElement.textContent = visitorCount;
                posterVisitorCount.textContent = visitorCount;
                posterWish.textContent = wishInput.value.trim() || "愿所有努力都不被辜负";

                lanternContainer.style.transition = 'transform 10s ease-in, opacity 10s ease-in';
                lanternContainer.style.transform = `translateY(-100vh) rotate(${Math.random() * 40 - 20}deg)`;
                lanternContainer.style.opacity = '0';
                
                setTimeout(() => {
                    wishingModal.classList.add('fade-out');
                    posterModal.classList.remove('hidden');
                    posterModal.classList.add('fade-in');
                }, 1500);
            }
            
            copyLinkBtn.addEventListener('click', () => {
                const baseUrl = window.location.href.split('?')[0];
                const shareUrl = `${baseUrl}?ref=${userWishId}`;
                copyToClipboard(shareUrl);
            });
            queryScoreBtn.addEventListener('click', () => {
                const candidateNo = mmkNoInput.value.trim();
                const password = mmkPwdInput.value.trim();

                if (!candidateNo || !password) {
                    scoreResultDiv.textContent = '请输入完整的报名号和密码！';
                    return;
                }

                queryScoreBtn.disabled = true;
                queryScoreBtn.textContent = '正在查询...';
                scoreResultDiv.textContent = '';
                const formData = new FormData();
                formData.append('mmkNo', candidateNo);
                formData.append('mmkPwd', password);
                fetch('https://gk.hngkcx.top/ScoreloginHome', {
                    method: 'POST',
                    body: formData

                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP 错误! 状态: ${response.status}`);
                    }
                    return response.text(); 
                })
                .then(data => {
                    scoreResultDiv.textContent = '查询成功！';
                    console.log('Response Data:', data);
                    queryScoreBtn.disabled = false;
                    queryScoreBtn.textContent = '立即查分';
                })
                .catch(error => {
                    // This is the MOST LIKELY outcome.
                    console.error('查询失败:', error);
                    scoreResultDiv.textContent = '（网络繁忙）'; 
                    queryScoreBtn.disabled = false;
                    queryScoreBtn.textContent = '重新查询';
                });
            });


            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('ref')) {
                referralBanner.classList.remove('hidden');
            }

            updateCountdown();
            setInterval(updateCountdown, 1000);
            createStars();
        });
    </script>
</body>
</html>
